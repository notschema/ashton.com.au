---
/**
 * Blog Index Page
 */
import BaseLayout from '../../layouts/BaseLayout.astro';
import { SITE } from '../../consts';
import { getCollection } from 'astro:content';
import { formatDate } from '../../lib/utils';

const posts = await getCollection('blog', ({ data }) => !data.draft);
const sortedPosts = posts.sort((a, b) => 
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);
---

<BaseLayout title={`Blog | ${SITE.title}`} description="Blog posts by Ashton.">
  <div class="mx-auto max-w-4xl px-4 py-16">
    <h1 class="mb-4 text-4xl font-bold">Blog</h1>
    <p class="mb-12 text-lg text-muted-foreground">
      Thoughts on security, infrastructure, and tech.
    </p>

    <div class="flex flex-col gap-8">
      {sortedPosts.map((post) => (
        <article class="group border-b border-border pb-8 last:border-0">
          <a href={`/blog/${post.id}`} class="block">
            <time class="text-sm text-muted-foreground">
              {formatDate(post.data.date)}
            </time>
            <h2 class="mt-2 text-2xl font-semibold text-foreground group-hover:text-primary transition-colors">
              {post.data.title}
            </h2>
            <p class="mt-2 text-muted-foreground">
              {post.data.description}
            </p>
            
            {post.data.tags && (
              <div class="mt-4 flex flex-wrap gap-2">
                {post.data.tags.map((tag: string) => (
                  <span class="rounded-full bg-muted px-3 py-1 text-xs font-medium text-muted-foreground">
                    {tag}
                  </span>
                ))}
              </div>
            )}
          </a>
        </article>
      ))}
    </div>

    {sortedPosts.length === 0 && (
      <p class="text-center text-muted-foreground">
        No posts yet. Check back soon!
      </p>
    )}
  </div>
</BaseLayout>
